# Task Configuration for Owned Note Auditor Crew
# 自营笔记审计员 Crew 的任务配置
#
# 2 sequential tasks: extract features → generate report

extract_content_features:
  description: |
    **任务目标**: 提取自营笔记的文本和视觉特征

    分析笔记ID: {note_id}，关键词: {keyword}

    **执行步骤**:
    1. 调用 nlp_text_analysis(note_id="{note_id}")
       - ⚠️ 重要: 只传 note_id 参数，工具会自动获取该笔记的文本内容并分析
       - 返回 TextAnalysisResult (30+ 个文本特征)
       - 包含: title_pattern, opening_strategy, content_framework, pain_points, value_propositions等

    2. 调用 multimodal_vision_analysis(note_id="{note_id}")
       - ⚠️ 重要: 只传 note_id 参数，工具会自动获取该笔记的图片并分析
       - 返回 VisionAnalysisResult (17+ 个视觉特征)
       - 包含: thumbnail_appeal, color_scheme, visual_tone, layout_style等

    3. 记录两个工具的完整JSON输出，供后续任务使用

    **禁止事项**:
    - ❌ 不要创造或想象笔记内容
    - ❌ 不要传递 note_metadata 参数（工具会自动获取）
    - ❌ 不要对特征做"好坏"判断（保持客观）
    - ✅ 只使用真实的笔记ID: {note_id}
    - ✅ 让工具自动处理数据获取

  expected_output: "Combined text and visual features (TextAnalysisResult + VisionAnalysisResult JSON)"
  agent: owned_note_auditor


generate_audit_report:
  description: |
    **任务目标**: 生成客观的自营笔记审计报告

    基于上游任务的结果，创建完整的 AuditReport。

    **执行步骤**:

    1. 收集基础信息:
       - note_id: {note_id}
       - keyword: {keyword}

    2. 收集分析结果:
       - text_features: TextAnalysisResult (from Task 1)
       - visual_features: VisionAnalysisResult (from Task 1)

    3. 生成客观特征摘要 (feature_summary):
       - 长度: 50-300个字符
       - 内容: 描述笔记的特征组合，包括:
         * 标题特征 (title_pattern, title_emotion)
         * 开头策略 (opening_strategy, opening_hook)
         * 正文框架 (content_framework)
         * 结尾技巧 (ending_technique)
         * 视觉风格 (image_style, color_scheme, visual_tone)
       - **关键要求**: 必须客观描述，不含任何"好坏强弱"的判断词
       - 示例:
         "该笔记采用疑问句标题配合情感词汇,开头使用对比钩子吸引注意,正文框架为问题解决型结构,
          封面视觉风格简约清新,色彩方案以蓝白为主,整体呈现专业可信的调性。"

    4. 添加时间戳:
       - audit_timestamp: 当前时间 (ISO 8601 格式, e.g., "2025-11-20T15:30:00Z")

    5. 创建完整的 AuditReport JSON，确保符合以下schema:
       ```
       {
         "note_id": str,
         "keyword": str,
         "text_features": TextAnalysisResult,
         "visual_features": VisionAnalysisResult,
         "feature_summary": str (50-300 chars, 客观描述),
         "audit_timestamp": str
       }
       ```

    **验证要点**:
    - feature_summary 必须 50-300 字符
    - feature_summary 不能包含判断词: 好/坏/弱/差/优秀/不足/weak/bad/poor/strong/excellent
    - 所有嵌套对象 (text_features, visual_features) 必须完整

    **禁止事项**:
    - ❌ 不要判断指标"强弱"（需要竞品数据对比）
    - ❌ 不要识别"内容弱点"（需要竞品数据对比）
    - ❌ 不要生成"优化建议"（那是 OptimizationStrategist 的职责）
    - ✅ 只做客观的内容理解和特征提取

    **输出格式要求（严格执行）**:
    - ⚠️ 只输出 JSON，不要有任何额外文字或解释
    - ⚠️ 不要使用 markdown 代码块 (```json)
    - ⚠️ JSON 必须完整且格式正确，不能有语法错误
    - ⚠️ 不要在最后一个字段后添加逗号 (trailing comma)
    - ⚠️ 所有字符串必须正确转义（如引号、换行符）
    - ✅ 直接输出符合 AuditReport schema 的单个 JSON 对象
    - ✅ 使用标准 JSON 格式（RFC 8259），不使用 JSON5 或其他扩展

  expected_output: "A single valid JSON object conforming to AuditReport schema (no additional text or markdown)"
  agent: owned_note_auditor
  output_file: "outputs/audit_report.json"
